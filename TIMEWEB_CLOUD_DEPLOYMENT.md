# Развертывание на Timeweb Cloud

## 1. Создание базы данных

1. Войдите в панель управления Timeweb Cloud
2. Перейдите в раздел "Базы данных"
3. Нажмите "Создать"
4. Выберите MySQL 8.0
5. Выберите тариф (рекомендуется минимум 1GB RAM)
6. После создания сохраните:
   - Хост
   - Порт (обычно 3306)
   - Имя базы данных
   - Пользователь
   - Пароль

## 2. Настройка бэкенда

1. В панели Timeweb Cloud перейдите в "Приложения"
2. Нажмите "Создать"
3. Выберите "Node.js"
4. Укажите имя (например, monastyr-backend)
5. Выберите ветку main
6. Перейдите в настройки окружения и установите переменные:
   ```
   NODE_ENV=production
   PORT=3000
   DATABASE_URL=mysql://user:password@host:3306/dbname
   JWT_SECRET=ваш-секретный-ключ
   ADMIN_REGISTRATION_KEY=ваш-ключ-админа
   UPLOAD_DIR=/app/uploads
   MAX_FILE_SIZE=10485760
   FRONTEND_URL=https://ваш-фронтенд.timeweb.app
   ```

7. Нажмите "Создать приложение"

## 3. Настройка фронтенда

1. Создайте новое приложение
2. Выберите "Node.js"
3. Укажите имя (например, monastyr-frontend)
4. Выберите ветку main
5. В настройках окружения установите:
   ```
   NODE_ENV=production
   VITE_API_URL=https://ваш-бэкенд.timeweb.app
   ```

## 4. Миграция базы данных

1. Установите Timeweb CLI:
   ```bash
   npm install -g @timeweb-cloud/cli
   ```

2. Войдите в аккаунт:
   ```bash
   tw login
   ```

3. Подключитесь к бэкенду:
   ```bash
   tw ssh your-backend-app
   ```

4. Запустите миграции:
   ```bash
   npx prisma migrate deploy
   ```

## 5. Проверка

1. Откройте URL фронтенда в браузере
2. Проверьте работу API через Swagger или Postman
3. Зарегистрируйте администратора через API, используя ADMIN_REGISTRATION_KEY
4. Проверьте загрузку файлов
5. Проверьте работу базы данных

## Важные заметки

1. CORS настроен автоматически для доменов .timeweb.app и .timeweb.cloud
2. Фронтенд автоматически подключается к бэкенду через переменную VITE_API_URL
3. Файлы загружаются в директорию /app/uploads
4. База данных автоматически мигрирует при деплое
5. Для обновления приложения достаточно сделать push в репозиторий

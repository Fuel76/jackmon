import { PrismaClient } from '@prisma/client';
import { faker } from '@faker-js/faker';

const prisma = new PrismaClient();

async function main() {
  console.log('Функция main начала выполнение.');

  try {
    // Администратор создаётся только через API регистрации!
    console.log('Начало сидирования новостей с сайта...');
    // Генерация новостей на основе данных с сайта
    const newsData = [
      {
        title: 'Семь исторических фактов о святителе Димитрии',
        content: 'Святитель Димитрий (1651–1709) — митрополит Ростовский, знаменитый церковный писатель, собиратель и редактор жизнеописаний святых, автор драм и стихов. Что мы знаем о его жизни и трудах? 1. Будущий святитель Димитрий Ростовский, в отрочестве Даниил, родился в 1651 году, в семье сотника Саввы Туптало. Отрок оказался более склонен к учению, чем к воинской службе. После достижения совершеннолетия ушел в Киевский Кириллов монастырь, где принял постриг с именем Димитрий. Вскоре отец последовал за сыном и также принял монашество.',
        htmlContent: '<p>Святитель Димитрий (1651–1709) — митрополит Ростовский, знаменитый церковный писатель, собиратель и редактор жизнеописаний святых, автор драм и стихов. Что мы знаем о его жизни и трудах?</p><ol><li>Будущий святитель Димитрий Ростовский, в отрочестве Даниил, родился в 1651 году, в семье сотника Саввы Туптало. Отрок оказался более склонен к учению, чем к воинской службе. После достижения совершеннолетия ушел в Киевский Кириллов монастырь, где принял постриг с именем Димитрий. Вскоре отец последовал за сыном и также принял монашество.</li></ol>',
        cover: 'http://www.rostov-monastir.ru/uploads/news24/24_09_06_svt_dimitrij_7.jpg',
        isVisible: true,
      },
      {
        title: 'Музей под куполом храма',
        content: 'Монастырский музей-ризница Спасо-Яковлевской Димитриевой обители Ростова Великого – живая история Церкви. Организации музея в стенах монастыря способствовали две важные даты: 370 лет со дня рождения святителя Димитрия Ростовского, мощи которого пребывают монастырском соборе, и 30-летие возрождения монашеской жизни в обители.',
        htmlContent: '<p>Монастырский музей-ризница Спасо-Яковлевской Димитриевой обители Ростова Великого – живая история Церкви.</p><p>Организации музея в стенах монастыря способствовали две важные даты: 370 лет со дня рождения святителя Димитрия Ростовского, мощи которого пребывают монастырском соборе, и 30-летие возрождения монашеской жизни в обители.</p>',
        cover: 'http://www.rostov-monastir.ru/uploads/news24/24_09_05_mvest_muzej.jpg',
        isVisible: true,
      },
      {
        title: 'Архимандрит Сильвестр: «В монастыре главное – послушание»',
        content: 'Несомненно, время оставляет свой отпечаток на каждом человеке. Что отличает послушников, приходящих в монастыри сегодня, и почему сейчас люди редко стремятся посвятить свою жизнь служению Богу? Архимандрита Сильвестра (Лукашенко) «Монастырский вестник» попросил ответить на вопросы, касающиеся особенностей духовной жизни современных монастырей. Также отец Сильвестр рассказал, почему именно послушание – главная монашеская добродетель. Беседовала Екатерина Орлова.',
        htmlContent: '<p>Несомненно, время оставляет свой отпечаток на каждом человеке. Что отличает послушников, приходящих в монастыри сегодня, и почему сейчас люди редко стремятся посвятить свою жизнь служению Богу?</p><p>Архимандрита Сильвестра (Лукашенко) «Монастырский вестник» попросил ответить на вопросы, касающиеся особенностей духовной жизни современных монастырей. Также отец Сильвестр рассказал, почему именно послушание – главная монашеская добродетель. Беседовала Екатерина Орлова.</p>',
        cover: 'http://www.rostov-monastir.ru/uploads/news24/24_09_04_mvest_arh-silvestr.jpg',
        isVisible: true,
      }
    ];

    for (const newsItem of newsData) {
      await prisma.news.create({
        data: {
          ...newsItem,
          media: Array.from({ length: faker.number.int({ min: 0, max: 1 }) }, () => faker.image.url()), // Добавим случайное медиа
        },
      });
    }
    console.log(`Добавлено ${newsData.length} новостей с сайта.`);

    console.log('Начало сидирования страниц с сайта...');
    // Генерация тестовых страниц на основе данных с сайта
    const pagesData = [
      {
        slug: 'o-monastyre',
        title: 'Монастырь сегодня',
        content: 'В 1991 году Спасо-Яковлевский монастырь был возвращен Русской Православной Церкви и стал первой возрожденной обителью Ростова. Монастырское богослужение было возобновлено на св. Пасху, 7 апреля 1991 г. В соборе Святителя Димитрия Ростовского Пасхальную службу совершил настоятель Ростовского Успенского собора игумен Сильвестр. Символично, что в том году Воскресение Христово совпало с Благовещением, так возрождение обители было ознаменовано слиянием двух великих праздников.',
        isVisible: true,
        metaDescription: 'Спасо-Яковлевский Димитриев мужской монастырь в Ростове Великом. История и современность.',
        metaKeywords: 'монастырь, ростов великий, православие, история, святитель димитрий',
      },
      {
        slug: 'kontakty',
        title: 'Контакты',
        content: 'Спасо-Яковлевский Димитриев мужской монастырь. Адрес: 152153, Ярославская область, г. Ростов, ул. Энгельса, 44. Телефон: (48536) 7-44-71. Email: info@rostov-monastir.ru',
        isVisible: true,
        metaDescription: 'Контактная информация Спасо-Яковлевского Димитриева мужского монастыря.',
        metaKeywords: 'контакты, адрес, телефон, email, монастырь',
      },
      {
        slug: 'raspisanie-bogosluzhenij',
        title: 'Расписание богослужений',
        content: 'Богослужения в Спасо-Яковлевском Димитриевом монастыре совершаются ежедневно. Уточняйте расписание по телефону монастыря.',
        isVisible: true,
        metaDescription: 'Расписание богослужений в Спасо-Яковлевском Димитриевом монастыре.',
        metaKeywords: 'расписание, богослужения, службы, монастырь',
      }
    ];

    for (const pageItem of pagesData) {
      await prisma.page.create({
        data: {
          ...pageItem,
          customCss: '', // Оставляем пустым или добавляем стили при необходимости
          history: [], // Оставляем пустым или добавляем историю изменений
        },
      });
    }
    console.log(`Добавлено ${pagesData.length} страниц с сайта.`);

    console.log('Начало генерации случайных новостей...');
    // Генерация случайных новостей с использованием faker для разнообразия
    let randomNewsCount = 0;
    for (let i = 0; i < 10; i++) {
      await prisma.news.create({
        data: {
          title: faker.lorem.sentence(5),
          content: faker.lorem.paragraphs(faker.number.int({ min: 2, max: 5 })),
          htmlContent: `<p>${faker.lorem.paragraphs(faker.number.int({ min: 2, max: 5 }), '</p><p>')}</p>`,
          media: Array.from({ length: faker.number.int({ min: 0, max: 2 }) }, () => faker.image.urlPicsumPhotos()),
          cover: faker.image.urlPicsumPhotos(),
          isVisible: faker.datatype.boolean(0.8), // 80% новостей будут видимы
        },
      });
      randomNewsCount++;
    }
    console.log(`Добавлено ${randomNewsCount} случайных новостей.`);

    console.log('Начало генерации случайных страниц...');
    // Генерация случайных страниц с использованием faker
    let randomPagesCount = 0;
    for (let i = 0; i < 3; i++) {
      const title = faker.lorem.sentence(4);
      await prisma.page.create({
        data: {
          slug: faker.helpers.slugify(title).toLowerCase(),
          title: title,
          content: faker.lorem.paragraphs(faker.number.int({ min: 3, max: 7 })),
          isVisible: faker.datatype.boolean(0.9), // 90% страниц будут видимы
          customCss: '',
          metaDescription: faker.lorem.sentence(),
          metaKeywords: faker.lorem.words(5),
          history: [],
        },
      });
      randomPagesCount++;
    }
    console.log(`Добавлено ${randomPagesCount} случайных страниц.`);

    console.log('Сидирование завершено успешно!');
  } catch (error) {
    console.error('Ошибка в процессе сидирования:', error);
    throw error;
  }
}

main()
  .then(() => {
    console.log('Функция main успешно завершена.');
  })
  .catch((e) => {
    console.error('Ошибка при выполнении main:', e);
    process.exit(1);
  })
  .finally(async () => {
    console.log('Выполняется блок finally: отключение от Prisma.');
    await prisma.$disconnect();
    console.log('Prisma отключена.');
  });